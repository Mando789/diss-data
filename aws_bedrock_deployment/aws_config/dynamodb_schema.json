{
  "metadata": {
    "description": "DynamoDB table schemas for workflow optimization system state management",
    "version": "1.0",
    "purpose": "Track processing state, store results, and manage system coordination",
    "consistency": "Eventually consistent with strong consistency for critical operations"
  },
  "tables": [
    {
      "table_name": "workflow-processing-state",
      "description": "Main state tracking table for workflow processing sessions",
      "partition_key": {
        "attribute_name": "session_id",
        "attribute_type": "S"
      },
      "sort_key": {
        "attribute_name": "timestamp",
        "attribute_type": "N"
      },
      "attributes": [
        {
          "attribute_name": "session_id",
          "attribute_type": "S",
          "description": "Unique identifier for processing session"
        },
        {
          "attribute_name": "timestamp",
          "attribute_type": "N",
          "description": "Unix timestamp for state updates"
        },
        {
          "attribute_name": "workflow_id",
          "attribute_type": "S",
          "description": "Identifier for specific workflow being processed"
        },
        {
          "attribute_name": "processing_stage",
          "attribute_type": "S",
          "description": "Current processing stage (input|analysis|optimization|output|complete)"
        },
        {
          "attribute_name": "agent_status",
          "attribute_type": "M",
          "description": "Map of agent statuses and results"
        },
        {
          "attribute_name": "input_data",
          "attribute_type": "M",
          "description": "Original input data and metadata"
        },
        {
          "attribute_name": "processing_results",
          "attribute_type": "M",
          "description": "Results from each agent"
        },
        {
          "attribute_name": "quality_metrics",
          "attribute_type": "M",
          "description": "Quality scores and validation results"
        },
        {
          "attribute_name": "error_log",
          "attribute_type": "L",
          "description": "List of errors encountered during processing"
        },
        {
          "attribute_name": "ttl",
          "attribute_type": "N",
          "description": "Time to live for automatic cleanup"
        }
      ],
      "global_secondary_indexes": [
        {
          "index_name": "workflow-id-index",
          "partition_key": {
            "attribute_name": "workflow_id",
            "attribute_type": "S"
          },
          "sort_key": {
            "attribute_name": "timestamp",
            "attribute_type": "N"
          },
          "projection": "ALL"
        },
        {
          "index_name": "processing-stage-index",
          "partition_key": {
            "attribute_name": "processing_stage",
            "attribute_type": "S"
          },
          "sort_key": {
            "attribute_name": "timestamp",
            "attribute_type": "N"
          },
          "projection": "KEYS_ONLY"
        }
      ],
      "billing_mode": "PAY_PER_REQUEST",
      "point_in_time_recovery": true,
      "stream_specification": {
        "stream_enabled": true,
        "stream_view_type": "NEW_AND_OLD_IMAGES"
      },
      "tags": {
        "Environment": "production",
        "Project": "workflow-optimization",
        "Purpose": "state-management"
      }
    },
    {
      "table_name": "agent-performance-metrics",
      "description": "Performance and quality metrics for individual agents",
      "partition_key": {
        "attribute_name": "agent_name",
        "attribute_type": "S"
      },
      "sort_key": {
        "attribute_name": "metric_timestamp",
        "attribute_type": "N"
      },
      "attributes": [
        {
          "attribute_name": "agent_name",
          "attribute_type": "S",
          "description": "Name of the agent (input|analysis|optimization|output|orchestration)"
        },
        {
          "attribute_name": "metric_timestamp",
          "attribute_type": "N",
          "description": "Timestamp when metrics were recorded"
        },
        {
          "attribute_name": "session_id",
          "attribute_type": "S",
          "description": "Processing session identifier"
        },
        {
          "attribute_name": "execution_time_ms",
          "attribute_type": "N",
          "description": "Agent execution time in milliseconds"
        },
        {
          "attribute_name": "quality_score",
          "attribute_type": "N",
          "description": "Quality assessment score (0.0 to 1.0)"
        },
        {
          "attribute_name": "accuracy_metrics",
          "attribute_type": "M",
          "description": "Detailed accuracy measurements"
        },
        {
          "attribute_name": "framework_alignment_score",
          "attribute_type": "N",
          "description": "How well output aligns with framework principles"
        },
        {
          "attribute_name": "error_count",
          "attribute_type": "N",
          "description": "Number of errors encountered"
        },
        {
          "attribute_name": "retry_count",
          "attribute_type": "N",
          "description": "Number of retries required"
        },
        {
          "attribute_name": "memory_usage_mb",
          "attribute_type": "N",
          "description": "Peak memory usage in MB"
        },
        {
          "attribute_name": "bedrock_tokens_used",
          "attribute_type": "N",
          "description": "Number of tokens consumed from Bedrock"
        }
      ],
      "global_secondary_indexes": [
        {
          "index_name": "session-metrics-index",
          "partition_key": {
            "attribute_name": "session_id",
            "attribute_type": "S"
          },
          "sort_key": {
            "attribute_name": "metric_timestamp",
            "attribute_type": "N"
          },
          "projection": "ALL"
        },
        {
          "index_name": "quality-score-index",
          "partition_key": {
            "attribute_name": "agent_name",
            "attribute_type": "S"
          },
          "sort_key": {
            "attribute_name": "quality_score",
            "attribute_type": "N"
          },
          "projection": "INCLUDE",
          "non_key_attributes": ["session_id", "metric_timestamp", "execution_time_ms"]
        }
      ],
      "billing_mode": "PAY_PER_REQUEST",
      "point_in_time_recovery": true,
      "ttl_attribute": "ttl",
      "tags": {
        "Environment": "production",
        "Project": "workflow-optimization",
        "Purpose": "performance-monitoring"
      }
    },
    {
      "table_name": "workflow-optimization-results",
      "description": "Store optimization results and recommendations",
      "partition_key": {
        "attribute_name": "workflow_id",
        "attribute_type": "S"
      },
      "sort_key": {
        "attribute_name": "optimization_timestamp",
        "attribute_type": "N"
      },
      "attributes": [
        {
          "attribute_name": "workflow_id",
          "attribute_type": "S",
          "description": "Unique workflow identifier"
        },
        {
          "attribute_name": "optimization_timestamp",
          "attribute_type": "N",
          "description": "When optimization was completed"
        },
        {
          "attribute_name": "session_id",
          "attribute_type": "S",
          "description": "Processing session that generated results"
        },
        {
          "attribute_name": "inefficiency_score",
          "attribute_type": "N",
          "description": "Overall inefficiency score (1-10)"
        },
        {
          "attribute_name": "optimization_potential",
          "attribute_type": "N",
          "description": "Estimated improvement potential (percentage)"
        },
        {
          "attribute_name": "framework_violations",
          "attribute_type": "L",
          "description": "List of identified framework violations"
        },
        {
          "attribute_name": "recommendations",
          "attribute_type": "L",
          "description": "List of optimization recommendations"
        },
        {
          "attribute_name": "expected_roi",
          "attribute_type": "M",
          "description": "Expected return on investment metrics"
        },
        {
          "attribute_name": "implementation_timeline",
          "attribute_type": "S",
          "description": "Estimated implementation timeline"
        },
        {
          "attribute_name": "stakeholder_impact",
          "attribute_type": "M",
          "description": "Impact assessment by stakeholder group"
        },
        {
          "attribute_name": "output_formats",
          "attribute_type": "M",
          "description": "Generated output documents and their S3 locations"
        },
        {
          "attribute_name": "validation_status",
          "attribute_type": "S",
          "description": "Validation status (pending|validated|failed)"
        }
      ],
      "global_secondary_indexes": [
        {
          "index_name": "inefficiency-score-index",
          "partition_key": {
            "attribute_name": "inefficiency_score",
            "attribute_type": "N"
          },
          "sort_key": {
            "attribute_name": "optimization_timestamp",
            "attribute_type": "N"
          },
          "projection": "INCLUDE",
          "non_key_attributes": ["workflow_id", "optimization_potential", "session_id"]
        },
        {
          "index_name": "optimization-potential-index",
          "partition_key": {
            "attribute_name": "optimization_potential",
            "attribute_type": "N"
          },
          "sort_key": {
            "attribute_name": "optimization_timestamp",
            "attribute_type": "N"
          },
          "projection": "KEYS_ONLY"
        }
      ],
      "billing_mode": "PAY_PER_REQUEST",
      "point_in_time_recovery": true,
      "tags": {
        "Environment": "production",
        "Project": "workflow-optimization",
        "Purpose": "results-storage"
      }
    },
    {
      "table_name": "system-configuration",
      "description": "System configuration and feature flags",
      "partition_key": {
        "attribute_name": "config_category",
        "attribute_type": "S"
      },
      "sort_key": {
        "attribute_name": "config_key",
        "attribute_type": "S"
      },
      "attributes": [
        {
          "attribute_name": "config_category",
          "attribute_type": "S",
          "description": "Configuration category (agents|frameworks|thresholds|features)"
        },
        {
          "attribute_name": "config_key",
          "attribute_type": "S",
          "description": "Specific configuration key"
        },
        {
          "attribute_name": "config_value",
          "attribute_type": "S",
          "description": "Configuration value (string representation)"
        },
        {
          "attribute_name": "data_type",
          "attribute_type": "S",
          "description": "Data type of the value (string|number|boolean|json)"
        },
        {
          "attribute_name": "description",
          "attribute_type": "S",
          "description": "Human-readable description of the configuration"
        },
        {
          "attribute_name": "last_updated",
          "attribute_type": "N",
          "description": "Timestamp of last update"
        },
        {
          "attribute_name": "updated_by",
          "attribute_type": "S",
          "description": "Who or what updated this configuration"
        },
        {
          "attribute_name": "version",
          "attribute_type": "N",
          "description": "Configuration version number"
        },
        {
          "attribute_name": "environment",
          "attribute_type": "S",
          "description": "Environment this config applies to (dev|staging|prod|all)"
        }
      ],
      "billing_mode": "PAY_PER_REQUEST",
      "point_in_time_recovery": true,
      "tags": {
        "Environment": "production",
        "Project": "workflow-optimization",
        "Purpose": "configuration-management"
      }
    }
  ],
  "data_patterns": {
    "workflow_processing_state": {
      "typical_item_size": "25KB",
      "read_patterns": [
        "Get current state by session_id",
        "Query session history by workflow_id",
        "Scan for stuck processing stages"
      ],
      "write_patterns": [
        "Update state at each processing stage",
        "Insert new processing session",
        "Update quality metrics and results"
      ],
      "access_frequency": "High during processing, low at rest"
    },
    "agent_performance_metrics": {
      "typical_item_size": "5KB",
      "read_patterns": [
        "Query metrics by agent and time range",
        "Aggregate performance across sessions",
        "Monitor quality trends over time"
      ],
      "write_patterns": [
        "Insert metrics after each agent execution",
        "Batch insert for performance optimization"
      ],
      "access_frequency": "High write, moderate read for monitoring"
    },
    "workflow_optimization_results": {
      "typical_item_size": "50KB",
      "read_patterns": [
        "Retrieve results by workflow_id",
        "Query high-impact optimizations",
        "Search by inefficiency score range"
      ],
      "write_patterns": [
        "Insert complete optimization results",
        "Update validation status"
      ],
      "access_frequency": "Moderate write, high read for delivery"
    },
    "system_configuration": {
      "typical_item_size": "1KB",
      "read_patterns": [
        "Get configuration by category and key",
        "Query all configs for category",
        "Environment-specific configuration loading"
      ],
      "write_patterns": [
        "Update configuration values",
        "Insert new configuration items"
      ],
      "access_frequency": "High read during initialization, low write"
    }
  },
  "performance_considerations": {
    "hot_partitions": {
      "workflow_processing_state": "Distribute session_ids to avoid hot partitioning",
      "agent_performance_metrics": "Include agent_name to distribute load",
      "system_configuration": "Low volume, not a concern"
    },
    "query_optimization": {
      "use_gsi": "Use GSI for non-key attribute queries",
      "projection_types": "Use KEYS_ONLY or INCLUDE to minimize costs",
      "consistent_reads": "Use eventually consistent reads where possible"
    },
    "cost_optimization": {
      "ttl_usage": "Implement TTL for temporary data cleanup",
      "billing_mode": "Pay-per-request for variable workloads",
      "gsi_design": "Minimize number of GSIs to reduce costs"
    }
  },
  "monitoring_and_alerting": {
    "cloudwatch_metrics": [
      "ConsumedReadCapacityUnits",
      "ConsumedWriteCapacityUnits",
      "ThrottledRequests",
      "SystemErrors",
      "UserErrors"
    ],
    "custom_metrics": [
      "Processing session completion rate",
      "Average quality scores",
      "Error rates by processing stage"
    ],
    "alarms": [
      "High throttling rate",
      "Elevated error rates",
      "Unusual processing delays"
    ]
  }
}